{{-- TODO: add check for user-rights, if user is admin we should add possibility to edit page --}}


@if( true )

  <div ng-show="selectedPage == page">

    <div class="row">
      <div class="col-xs-12">
        {{-- <p contenteditable ng-model="page.title" strip-br="true">@{{ page.title }}</p> --}}
      </div>
    </div>

    <div class="row">
      {{-- START: Image --}}
      <div class="col-md-8 col-xs-12" ng-controller="ImageController">
        <div ng-if="(+page.images.length > 0)" ng-file-drop="onFileSelect($files, page)" ng-file-drag-over-class="optional-css-class">
          <img class="img-responsive" ng-src="uploads/@{{ page.images[page.images.length-1].filename }}" />
        </div>
        <div ng-if="(+page.images.length <= 0)" ng-file-drop="onFileSelect($files, page)" ng-file-drag-over-class="optional-css-class">
          <img class="img-rounded img-responsive" ph-img="800x400" ph-txt="Drop image here"/>
        </div>
      </div>
      {{-- END: Image --}}

      {{-- START: News --}}
      <div class="col-md-4 visible-md visible-lg news-container">
        <h2>Nyheter <small><span class="glyphicon glyphicon-plus-sign" ng-click="openNewsModal()"></span></small></h2>
        <div ng-repeat="n in news" class="news-item">
          <h4>@{{ n.title }} <small><span class="glyphicon glyphicon-minus-sign" ng-click="deleteNews(n)"></span></small> <small><span class="glyphicon glyphicon-question-sign" ng-click="openNewsModal(n)"></span></small></h4>
          <p>@{{ n.body | cut:true:100:' ...' }}</p>
          <p>@{{ n.created_at | brDateFilter | date:"yyyy-MM-dd" }}</p>
          <hr>
        </div>
      </div>
      {{-- END: News --}}
    </div>

    <div class="row">
      {{-- START: Heading --}}
      <div class="col-xs-12">
        <h1 class="edit-menu" contenteditable ng-model="page.heading" strip-br="true" ng-mouseenter="showHeadingTools = true" ng-mouseleave="showHeadingTools = false">@{{ page.heading }}</h1>
        <div class="edit-toolbox" ng-show="showHeadingTools" ng-mouseenter="showHeadingTools = true" ng-mouseleave="showHeadingTools = false">
          <span class="glyphicon glyphicon-ok" ng-click="savePage(page)"></span>
        </div>
      </div>
      {{-- END: Heading --}}

      {{-- START: Textables --}}
      <div ng-controller="TextController">
        <div class="col-md-@{{ 12 / page.texts.length }} edit-menu" ng-repeat="text in page.texts" ng-if="(+page.texts.length > 0)">
          <p contenteditable ng-mouseenter="showTextTools = true" ng-mouseleave="showTextTools = false" ng-model="text.description" strip-br="true" {{--ng-if="(+text.description.length > 0)"--}}>@{{ text.description }}</p>
          <p ng-if="(+text.description.length <= 0)" contenteditable ng-mouseenter="showTextTools = true" ng-mouseleave="showTextTools = false" ng-model="text.description" strip-br="true" ph-txt="@{{ numCombined }}"></p>
          <div class="edit-toolbox" ng-show="showTextTools" ng-mouseenter="showTextTools = true" ng-mouseleave="showTextTools = false">
            <span class="glyphicon glyphicon-remove-sign" ng-click="deleteText(text)"></span><br/>
            <span class="glyphicon glyphicon-ok" ng-click="savePage(page)"></span><br/>
            <span class="glyphicon glyphicon-plus-sign" ng-click="newTextable(page, 'Lipsum...')"></span>
          </div>
        </div>
        <div ng-if="(+page.texts.length <= 0)">
          <div class="col-xs-12">
            <span class="glyphicon glyphicon-ok-sign" ng-click="newTextable(page, 'Lipsum...')"></span> Add new column
          </div>
        </div>
      </div>
      {{-- END: Textables --}}
    </div>
  </div>




  <script id="newsModalContent.html" type="text/ng-template">
    <div class="modal-header">
      <h3>Add new news item</h3>
    </div>
    <div class="modal-body">
      <input class="form-control" type="text" placeholder="title" ng-model="newsitem.title">
      <textarea class="form-control" rows="3" placeholder="body" ng-model="newsitem.body"></textarea>
    </div>
    <div class="modal-footer">
      <div class="btn-group">
        <button type="button" class="btn btn-primary" ng-click="newsModalOk()">OK</button>
        <button type="button" class="btn btn-warning" ng-click="newsModalCancel()">Cancel</button>
      </div>
    </div>
  </script>

@else


  
  <div ng-show="selectedPage == page">

    <div class="row">

      <div class="col-md-8 col-xs-12" ng-controller="ImageController">

        <div ng-if="(+page.images.length > 0)">
          <img class="img-responsive" ng-src="uploads/@{{ page.images[page.images.length-1].filename }}" />
        </div>

        <div ng-if="(+page.images.length <= 0)">
          <img class="img-rounded img-responsive" ph-img="800x400" ph-txt="No image found"/>
        </div>
      </div>

      <div class="col-md-4 visible-md visible-lg" ng-controller="NewsController">
        <h2>Nyheter</h2>
        <div ng-repeat="n in news" class="news-item">
          <h4>@{{ n.title }}</h4>
          <p>@{{ n.body | cut:true:100:' ...' }}</p>
          <p>@{{ n.created_at | brDateFilter | date:"yyyy-MM-dd" }}</p>
          <hr>
        </div>
      </div>

    </div>

    <div class="row">

      <div class="col-xs-12">
        <h1 ng-model="page.heading">@{{ page.heading }}</h1>
      </div>

      {{-- START: Textables --}}
      <div class="col-md-@{{ 12 / page.texts.length }}" ng-repeat="text in page.texts" ng-controller="TextController" ng-if="(+page.texts.length > 0)">
        <p ng-model="text.description">@{{ text.description }}</p>
        <p ng-if="(+text.description.length <= 0)" ng-model="text.description" ph-txt="@{{ numCombined }}"></p>
      </div>
      {{-- END: Textables --}}

    </div>

      
    
  </div>

  
@endif